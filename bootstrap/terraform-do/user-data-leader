#cloud-config
repo_update: true
repo_upgrade: security
packages:
  - ca-certificates
  - jq
  - git
  - curl
  - unzip
write_files:
  - path: /tmp/env.ikt
    content: |
      {{ global "/do/stackname" "${tpl_infrakit_group_suffix}" }}
      {{ global "/script/baseurl" "${tpl_config_base_url}" }}
  - path: /tmp/terraform.tfvars
    content: |
      do_name = "${tpl_do_name}"
      cluster_region = "${tpl_region}"
      cluster_size = "${tpl_size}"
      cluster_ssh_key = "${tpl_ssh_key}"
runcmd:
  - curl ${tpl_config_base_url}/bootstrap -o /usr/local/bin/bootstrap.sh
  - bash /usr/local/bin/bootstrap.sh -i -p terraform:/tmp/terraform.tfvars -t do -e /tmp/env.ikt ${tpl_config_base_url}
